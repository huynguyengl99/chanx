asyncapi: 3.0.0
info:
  title: CHANX AsyncAPI Documentation
  version: 1.0.0
  description: Websocket schema of Chanx
servers:
  production:
    host: testserver
    protocol: ws
channels:
  assistants:
    address: ws/assistants/{pk}/
    title: assistants
    description: AI Assistant WebSocket API
    parameters:
      pk:
        description: 'Path parameter for pk (regex: [0-9a-f-]+)'
    messages:
      assistantErrorMessage:
        $ref: '#/components/messages/assistantErrorMessage'
      completeStreamingMessage:
        $ref: '#/components/messages/completeStreamingMessage'
      newAssistantMessage:
        $ref: '#/components/messages/newAssistantMessage'
      pingMessage:
        $ref: '#/components/messages/pingMessage'
      pongMessage:
        $ref: '#/components/messages/pongMessage'
      streamingMessage:
        $ref: '#/components/messages/streamingMessage'
    tags:
    - name: ai
    - name: chat
  discussionList:
    address: ws/discussion/
    title: discussion_list
    description: '

      WebSocket consumer for discussion topic list view.


      Handles global discussion updates like new topics, votes, and answer acceptance/unacceptance.

      '
    messages:
      answerAcceptedMessage:
        $ref: '#/components/messages/answerAcceptedMessage'
      answerUnacceptedMessage:
        $ref: '#/components/messages/answerUnacceptedMessage'
      pingMessage:
        $ref: '#/components/messages/pingMessage'
      pongMessage:
        $ref: '#/components/messages/pongMessage'
      topicCreatedMessage:
        $ref: '#/components/messages/topicCreatedMessage'
      voteUpdatedMessage:
        $ref: '#/components/messages/voteUpdatedMessage'
  discussionTopic:
    address: ws/discussion/{pk}/
    title: discussion_topic
    description: '

      WebSocket consumer for discussion topic detail view.


      Handles topic-specific operations like replying, voting, and accepting/unaccepting
      answers.

      '
    parameters:
      pk:
        description: Path parameter for pk (int)
    messages:
      answerAcceptedMessage:
        $ref: '#/components/messages/answerAcceptedMessage'
      answerUnacceptedMessage:
        $ref: '#/components/messages/answerUnacceptedMessage'
      pingMessage:
        $ref: '#/components/messages/pingMessage'
      pongMessage:
        $ref: '#/components/messages/pongMessage'
      replyCreatedMessage:
        $ref: '#/components/messages/replyCreatedMessage'
      voteUpdatedMessage:
        $ref: '#/components/messages/voteUpdatedMessage'
  groupChat:
    address: ws/chat/group/
    title: group_chat
    description: '

      WebSocket consumer for group chat updates.

      '
    messages:
      addedToGroupMessage:
        $ref: '#/components/messages/addedToGroupMessage'
      groupChatUpdatedMessage:
        $ref: '#/components/messages/groupChatUpdatedMessage'
      pingMessage:
        $ref: '#/components/messages/pingMessage'
      pongMessage:
        $ref: '#/components/messages/pongMessage'
      removedFromGroupMessage:
        $ref: '#/components/messages/removedFromGroupMessage'
  chatDetail:
    address: ws/chat/{pk}/
    title: chat_detail
    description: WebSocket consumer for group chat details.
    parameters:
      pk:
        description: 'Path parameter for pk (regex: \d+)'
    messages:
      memberAddedMessage:
        $ref: '#/components/messages/memberAddedMessage'
      memberMessage:
        $ref: '#/components/messages/memberMessage'
      memberRemovedMessage:
        $ref: '#/components/messages/memberRemovedMessage'
      pingMessage:
        $ref: '#/components/messages/pingMessage'
      pongMessage:
        $ref: '#/components/messages/pongMessage'
      userRemovedFromGroupMessage:
        $ref: '#/components/messages/userRemovedFromGroupMessage'
operations:
  handlePing:
    action: receive
    channel:
      $ref: '#/channels/assistants'
    description: Simple ping-pong for connectivity testing
    summary: Handle ping requests
    messages:
    - $ref: '#/channels/assistants/messages/pingMessage'
    reply:
      channel:
        $ref: '#/channels/assistants'
      messages:
      - $ref: '#/channels/assistants/messages/pongMessage'
  handleCompleteStreaming:
    action: send
    channel:
      $ref: '#/channels/assistants'
    description: ''
    summary: ''
    messages:
    - $ref: '#/channels/assistants/messages/completeStreamingMessage'
  handleErrorAssistantEvent:
    action: send
    channel:
      $ref: '#/channels/assistants'
    description: ''
    summary: ''
    messages:
    - $ref: '#/channels/assistants/messages/assistantErrorMessage'
  handleNewAssistantMessage:
    action: send
    channel:
      $ref: '#/channels/assistants'
    description: ''
    summary: ''
    messages:
    - $ref: '#/channels/assistants/messages/newAssistantMessage'
  handleStreaming:
    action: send
    channel:
      $ref: '#/channels/assistants'
    description: ''
    summary: ''
    messages:
    - $ref: '#/channels/assistants/messages/streamingMessage'
  discussionListHandlePing:
    action: receive
    channel:
      $ref: '#/channels/discussionList'
    description: Simple ping-pong for connectivity testing
    summary: Handle ping requests
    messages:
    - $ref: '#/channels/discussionList/messages/pingMessage'
    reply:
      channel:
        $ref: '#/channels/discussionList'
      messages:
      - $ref: '#/channels/discussionList/messages/pongMessage'
  handleAcceptAnswer:
    action: send
    channel:
      $ref: '#/channels/discussionList'
    description: ''
    summary: ''
    messages:
    - $ref: '#/channels/discussionList/messages/answerAcceptedMessage'
  handleNewTopic:
    action: send
    channel:
      $ref: '#/channels/discussionList'
    description: ''
    summary: ''
    messages:
    - $ref: '#/channels/discussionList/messages/topicCreatedMessage'
  handleUnacceptAnswer:
    action: send
    channel:
      $ref: '#/channels/discussionList'
    description: ''
    summary: ''
    messages:
    - $ref: '#/channels/discussionList/messages/answerUnacceptedMessage'
  handleVoteUpdate:
    action: send
    channel:
      $ref: '#/channels/discussionList'
    description: ''
    summary: ''
    messages:
    - $ref: '#/channels/discussionList/messages/voteUpdatedMessage'
  discussionTopicHandlePing:
    action: receive
    channel:
      $ref: '#/channels/discussionTopic'
    description: Simple ping-pong for connectivity testing
    summary: Handle ping requests
    messages:
    - $ref: '#/channels/discussionTopic/messages/pingMessage'
    reply:
      channel:
        $ref: '#/channels/discussionTopic'
      messages:
      - $ref: '#/channels/discussionTopic/messages/pongMessage'
  discussionTopicHandleAcceptAnswer:
    action: send
    channel:
      $ref: '#/channels/discussionTopic'
    description: ''
    summary: ''
    messages:
    - $ref: '#/channels/discussionTopic/messages/answerAcceptedMessage'
  handleNewReply:
    action: send
    channel:
      $ref: '#/channels/discussionTopic'
    description: ''
    summary: ''
    messages:
    - $ref: '#/channels/discussionTopic/messages/replyCreatedMessage'
  discussionTopicHandleUnacceptAnswer:
    action: send
    channel:
      $ref: '#/channels/discussionTopic'
    description: ''
    summary: ''
    messages:
    - $ref: '#/channels/discussionTopic/messages/answerUnacceptedMessage'
  discussionTopicHandleVoteUpdate:
    action: send
    channel:
      $ref: '#/channels/discussionTopic'
    description: ''
    summary: ''
    messages:
    - $ref: '#/channels/discussionTopic/messages/voteUpdatedMessage'
  groupChatHandlePing:
    action: receive
    channel:
      $ref: '#/channels/groupChat'
    description: Simple ping-pong for connectivity testing
    summary: Handle ping requests
    messages:
    - $ref: '#/channels/groupChat/messages/pingMessage'
    reply:
      channel:
        $ref: '#/channels/groupChat'
      messages:
      - $ref: '#/channels/groupChat/messages/pongMessage'
  handleGroupChatUpdate:
    action: send
    channel:
      $ref: '#/channels/groupChat'
    description: ''
    summary: ''
    messages:
    - $ref: '#/channels/groupChat/messages/groupChatUpdatedMessage'
  handleNotifyAddedToGroup:
    action: send
    channel:
      $ref: '#/channels/groupChat'
    description: ''
    summary: ''
    messages:
    - $ref: '#/channels/groupChat/messages/addedToGroupMessage'
  handleNotifyRemovedFromGroup:
    action: send
    channel:
      $ref: '#/channels/groupChat'
    description: ''
    summary: ''
    messages:
    - $ref: '#/channels/groupChat/messages/removedFromGroupMessage'
  chatDetailHandlePing:
    action: receive
    channel:
      $ref: '#/channels/chatDetail'
    description: Simple ping-pong for connectivity testing
    summary: Handle ping requests
    messages:
    - $ref: '#/channels/chatDetail/messages/pingMessage'
    reply:
      channel:
        $ref: '#/channels/chatDetail'
      messages:
      - $ref: '#/channels/chatDetail/messages/pongMessage'
  handleMemberAdded:
    action: send
    channel:
      $ref: '#/channels/chatDetail'
    description: ''
    summary: ''
    messages:
    - $ref: '#/channels/chatDetail/messages/memberAddedMessage'
  handleMemberRemoved:
    action: send
    channel:
      $ref: '#/channels/chatDetail'
    description: ''
    summary: ''
    messages:
    - $ref: '#/channels/chatDetail/messages/userRemovedFromGroupMessage'
    - $ref: '#/channels/chatDetail/messages/memberRemovedMessage'
  handleNewChatMessage:
    action: send
    channel:
      $ref: '#/channels/chatDetail'
    description: ''
    summary: ''
    messages:
    - $ref: '#/channels/chatDetail/messages/memberMessage'
components:
  messages:
    addedToGroupMessage:
      payload:
        $ref: '#/components/schemas/addedToGroupMessage'
    answerAcceptedMessage:
      payload:
        $ref: '#/components/schemas/answerAcceptedMessage'
    answerUnacceptedMessage:
      payload:
        $ref: '#/components/schemas/answerUnacceptedMessage'
    assistantErrorMessage:
      payload:
        $ref: '#/components/schemas/assistantErrorMessage'
    completeStreamingMessage:
      payload:
        $ref: '#/components/schemas/completeStreamingMessage'
    groupChatUpdatedMessage:
      payload:
        $ref: '#/components/schemas/groupChatUpdatedMessage'
    memberAddedMessage:
      payload:
        $ref: '#/components/schemas/memberAddedMessage'
    memberMessage:
      payload:
        $ref: '#/components/schemas/memberMessage'
    memberRemovedMessage:
      payload:
        $ref: '#/components/schemas/memberRemovedMessage'
    newAssistantMessage:
      payload:
        $ref: '#/components/schemas/newAssistantMessage'
    pingMessage:
      payload:
        $ref: '#/components/schemas/pingMessage'
    pongMessage:
      payload:
        $ref: '#/components/schemas/pongMessage'
    removedFromGroupMessage:
      payload:
        $ref: '#/components/schemas/removedFromGroupMessage'
    replyCreatedMessage:
      payload:
        $ref: '#/components/schemas/replyCreatedMessage'
    streamingMessage:
      payload:
        $ref: '#/components/schemas/streamingMessage'
    topicCreatedMessage:
      payload:
        $ref: '#/components/schemas/topicCreatedMessage'
    userRemovedFromGroupMessage:
      payload:
        $ref: '#/components/schemas/userRemovedFromGroupMessage'
    voteUpdatedMessage:
      payload:
        $ref: '#/components/schemas/voteUpdatedMessage'
  schemas:
    addedToGroupMessage:
      properties:
        action:
          const: added_to_group
          default: added_to_group
          title: Action
          type: string
        payload:
          additionalProperties: true
          title: Payload
          type: object
      required:
      - payload
      title: AddedToGroupMessage
      type: object
    answerAcceptedEventPayload:
      description: Payload for answer accepted events.
      properties:
        topicId:
          title: Topic Id
          type: integer
        topicTitle:
          title: Topic Title
          type: string
        replyId:
          title: Reply Id
          type: integer
        replyAuthor:
          title: Reply Author
          type: string
      required:
      - topicId
      - topicTitle
      - replyId
      - replyAuthor
      title: AnswerAcceptedEventPayload
      type: object
    answerAcceptedMessage:
      description: Broadcast when an answer is accepted.
      properties:
        action:
          const: answer_accepted
          default: answer_accepted
          title: Action
          type: string
        payload:
          $ref: '#/components/schemas/answerAcceptedEventPayload'
      required:
      - payload
      title: AnswerAcceptedMessage
      type: object
    answerUnacceptedEventPayload:
      description: Payload for answer unaccepted events.
      properties:
        topicId:
          title: Topic Id
          type: integer
        topicTitle:
          title: Topic Title
          type: string
        replyId:
          title: Reply Id
          type: integer
        replyAuthor:
          title: Reply Author
          type: string
      required:
      - topicId
      - topicTitle
      - replyId
      - replyAuthor
      title: AnswerUnacceptedEventPayload
      type: object
    answerUnacceptedMessage:
      description: Broadcast when an answer is unaccepted.
      properties:
        action:
          const: answer_unaccepted
          default: answer_unaccepted
          title: Action
          type: string
        payload:
          $ref: '#/components/schemas/answerUnacceptedEventPayload'
      required:
      - payload
      title: AnswerUnacceptedMessage
      type: object
    assistantErrorMessage:
      description: Error message from assistant.
      properties:
        action:
          const: assistant_error
          default: assistant_error
          title: Action
          type: string
        payload:
          $ref: '#/components/schemas/errorPayload'
      required:
      - payload
      title: AssistantErrorMessage
      type: object
    completeStreamingMessage:
      description: Streaming message chunk from assistant.
      properties:
        action:
          const: complete_streaming
          default: complete_streaming
          title: Action
          type: string
        payload:
          $ref: '#/components/schemas/streamingPayload'
      required:
      - payload
      title: CompleteStreamingMessage
      type: object
    errorPayload:
      properties:
        content:
          title: Content
          type: string
        messageId:
          title: Message Id
          type: string
      required:
      - content
      - messageId
      title: ErrorPayload
      type: object
    groupChatUpdatePayload:
      properties:
        groupPk:
          title: Group Pk
          type: integer
        updatedAt:
          title: Updated At
          type: string
      required:
      - groupPk
      - updatedAt
      title: GroupChatUpdatePayload
      type: object
    groupChatUpdatedMessage:
      properties:
        action:
          const: group_chat_updated
          default: group_chat_updated
          title: Action
          type: string
        payload:
          $ref: '#/components/schemas/groupChatUpdatePayload'
      required:
      - payload
      title: GroupChatUpdatedMessage
      type: object
    groupRemovePayload:
      properties:
        groupPk:
          title: Group Pk
          type: integer
        groupTitle:
          title: Group Title
          type: string
      required:
      - groupPk
      - groupTitle
      title: GroupRemovePayload
      type: object
    memberAddedMessage:
      properties:
        action:
          const: member_added
          default: member_added
          title: Action
          type: string
        payload:
          additionalProperties: true
          title: Payload
          type: object
      required:
      - payload
      title: MemberAddedMessage
      type: object
    memberMessage:
      properties:
        action:
          const: member_message
          default: member_message
          title: Action
          type: string
        payload:
          additionalProperties: true
          title: Payload
          type: object
      required:
      - payload
      title: MemberMessage
      type: object
    memberRemovedMessage:
      properties:
        action:
          const: member_removed
          default: member_removed
          title: Action
          type: string
        payload:
          $ref: '#/components/schemas/memberRemovedPayload'
      required:
      - payload
      title: MemberRemovedMessage
      type: object
    memberRemovedPayload:
      properties:
        userPk:
          title: User Pk
          type: integer
        email:
          title: Email
          type: string
      required:
      - userPk
      - email
      title: MemberRemovedPayload
      type: object
    newAssistantMessage:
      description: New assistant message (user or AI).
      properties:
        action:
          const: new_assistant_message
          default: new_assistant_message
          title: Action
          type: string
        payload:
          additionalProperties: true
          title: Payload
          type: object
      required:
      - payload
      title: NewAssistantMessage
      type: object
    newReplyEventPayload:
      description: Payload for new reply channel events.
      properties:
        id:
          title: Id
          type: integer
        content:
          title: Content
          type: string
        author:
          additionalProperties: true
          title: Author
          type: object
        voteCount:
          title: Vote Count
          type: integer
        isAccepted:
          title: Is Accepted
          type: boolean
        createdAt:
          title: Created At
          type: string
        formattedCreatedAt:
          title: Formatted Created At
          type: string
        topicId:
          title: Topic Id
          type: integer
        topicTitle:
          title: Topic Title
          type: string
      required:
      - id
      - content
      - author
      - voteCount
      - isAccepted
      - createdAt
      - formattedCreatedAt
      - topicId
      - topicTitle
      title: NewReplyEventPayload
      type: object
    newTopicEventPayload:
      description: Payload for new topic channel events.
      properties:
        id:
          title: Id
          type: integer
        title:
          title: Title
          type: string
        author:
          additionalProperties: true
          title: Author
          type: object
        voteCount:
          title: Vote Count
          type: integer
        replyCount:
          title: Reply Count
          type: integer
        hasAcceptedAnswer:
          title: Has Accepted Answer
          type: boolean
        viewCount:
          title: View Count
          type: integer
        createdAt:
          title: Created At
          type: string
        formattedCreatedAt:
          title: Formatted Created At
          type: string
      required:
      - id
      - title
      - author
      - voteCount
      - replyCount
      - hasAcceptedAnswer
      - viewCount
      - createdAt
      - formattedCreatedAt
      title: NewTopicEventPayload
      type: object
    payload:
      properties:
        redirect:
          title: Redirect
          type: string
        message:
          title: Message
          type: string
      required:
      - redirect
      - message
      title: Payload
      type: object
    pingMessage:
      description: Simple ping message to check WebSocket connection status.
      properties:
        action:
          const: ping
          default: ping
          title: Action
          type: string
        payload:
          default: null
          title: Payload
          type: 'null'
      title: PingMessage
      type: object
    pongMessage:
      description: Simple pong message response to ping requests.
      properties:
        action:
          const: pong
          default: pong
          title: Action
          type: string
        payload:
          default: null
          title: Payload
          type: 'null'
      title: PongMessage
      type: object
    removedFromGroupMessage:
      properties:
        action:
          const: removed_from_group
          default: removed_from_group
          title: Action
          type: string
        payload:
          $ref: '#/components/schemas/groupRemovePayload'
      required:
      - payload
      title: RemovedFromGroupMessage
      type: object
    replyCreatedMessage:
      description: Broadcast when a new reply is created.
      properties:
        action:
          const: reply_created
          default: reply_created
          title: Action
          type: string
        payload:
          $ref: '#/components/schemas/newReplyEventPayload'
      required:
      - payload
      title: ReplyCreatedMessage
      type: object
    streamingMessage:
      description: Streaming message chunk from assistant.
      properties:
        action:
          const: streaming
          default: streaming
          title: Action
          type: string
        payload:
          $ref: '#/components/schemas/streamingPayload'
      required:
      - payload
      title: StreamingMessage
      type: object
    streamingPayload:
      properties:
        content:
          title: Content
          type: string
        isComplete:
          default: false
          title: Is Complete
          type: boolean
        messageId:
          title: Message Id
          type: integer
      required:
      - content
      - messageId
      title: StreamingPayload
      type: object
    topicCreatedMessage:
      description: Broadcast when a new topic is created.
      properties:
        action:
          const: topic_created
          default: topic_created
          title: Action
          type: string
        payload:
          $ref: '#/components/schemas/newTopicEventPayload'
      required:
      - payload
      title: TopicCreatedMessage
      type: object
    userRemovedFromGroupMessage:
      properties:
        action:
          const: user_removed_from_group
          default: user_removed_from_group
          title: Action
          type: string
        payload:
          $ref: '#/components/schemas/payload'
      required:
      - payload
      title: UserRemovedFromGroupMessage
      type: object
    votePayload:
      description: Base payload for vote-related operations.
      properties:
        targetType:
          enum:
          - topic
          - reply
          title: Target Type
          type: string
        targetId:
          title: Target Id
          type: integer
        voteCount:
          title: Vote Count
          type: integer
      required:
      - targetType
      - targetId
      - voteCount
      title: VotePayload
      type: object
    voteUpdatedMessage:
      description: Broadcast when votes are updated.
      properties:
        action:
          const: vote_updated
          default: vote_updated
          title: Action
          type: string
        payload:
          $ref: '#/components/schemas/votePayload'
      required:
      - payload
      title: VoteUpdatedMessage
      type: object
